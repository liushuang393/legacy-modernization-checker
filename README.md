# Legacy Modernization Checker
## OWASP Top 10:2025 è‡ªå‹•æ¤œè¨¼ãƒ»å¯¾ç­–ç”Ÿæˆãƒ„ãƒ¼ãƒ«

Spring Boot / Spring Batch ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‘ã‘ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è‡ªå‹•æ¤œè¨¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚

## ç›®çš„
- **OWASP Top 10:2025** ã«æº–æ‹ ã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ¤œè¨¼ã‚’è‡ªå‹•åŒ–
- æ¤œå‡ºã•ã‚ŒãŸè„†å¼±æ€§ã«å¯¾ã™ã‚‹ **å¯¾ç­–æ¡ˆã‚’è‡ªå‹•ç”Ÿæˆ**
- é¡§å®¢ãƒ»ç›£æŸ»å‘ã‘ã® **è¨¼è·¡ï¼ˆartifactï¼‰** ã‚’ä¸€æ‹¬å‡ºåŠ›

### ä¸»ãªæ©Ÿèƒ½
| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| **SAST** | Semgrep ã«ã‚ˆã‚‹é™çš„è§£æï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«å¯¾å¿œï¼‰ |
| **SCA** | Dependency-Check ã«ã‚ˆã‚‹ä¾å­˜é–¢ä¿‚è„†å¼±æ€§æ¤œå‡º |
| **SBOM** | CycloneDX å½¢å¼ã®éƒ¨å“è¡¨ç”Ÿæˆ |
| **DAST** | ZAP ã«ã‚ˆã‚‹å‹•çš„ã‚¹ã‚­ãƒ£ãƒ³ |
| **Container Scan** | Trivy ã«ã‚ˆã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸/FS ã‚¹ã‚­ãƒ£ãƒ³ |
| **Secret Detection** | Gitleaks ã«ã‚ˆã‚‹æ©Ÿå¯†æƒ…å ±æ¤œå‡º |
| **å¯¾ç­–æ¡ˆè‡ªå‹•ç”Ÿæˆ** | æ¤œå‡ºçµæœã‹ã‚‰ `security-remediation.md` ã‚’ç”Ÿæˆ |
| **çµ±åˆãƒ¬ãƒãƒ¼ãƒˆ** | å…¨çµæœã‚’1ã¤ã® HTML ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«é›†ç´„ |

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¸­èº«
- `.gitlab-ci.yml`ï¼šGitLab CI ã§ãƒ•ãƒ«æ¤œè¨¼
- `scripts/run_checks_local.sh`ï¼šãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ•ãƒ«æ¤œè¨¼
- `tools/semgrep/.semgrep.yml`ï¼šè‡ªç¤¾ Semgrep ãƒ«ãƒ¼ãƒ«ï¼ˆAutofix ä¾‹ã‚’å«ã‚€ï¼‰
-   â””/zap/automation.yaml`ï¼šZAP Automation Framework ã®è¨­å®š
-   â””/remediate/generate_remediation.py`ï¼šå¯¾ç­–æ¡ˆï¼ˆsecurity-remediation.mdï¼‰è‡ªå‹•ç”Ÿæˆ
- `docs/migration-design.md`ï¼šç§»è¡Œè¨­è¨ˆã®ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆåˆ¥é€”è¿½è¨˜ã™ã‚‹é‹ç”¨ï¼‰

---

## 2. ä½¿ã„æ–¹ï¼ˆæœ€çŸ­ï¼šæŒã¡è¾¼ã¿ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§çµæœã‚’å‡ºã™ï¼‰

### 2.1 æ–¹æ³•Aï¼šã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ã€Œæ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€ã«è¿½åŠ ï¼ˆæ¨å¥¨ï¼‰
1) æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆã«ã€ä»¥ä¸‹ã‚’ **ã‚³ãƒ”ãƒ¼**ï¼ˆã¾ãŸã¯ Git Subtree/Submoduleï¼‰  
   - `.gitlab-ci.yml`
   - `tools/`ï¼ˆsemgrep, zap, remediateï¼‰
   - `scripts/`
2) æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒ Maven ãªã‚‰ã€ãã®ã¾ã¾å‹•ãã¾ã™ã€‚Gradle ã§ã‚‚ SAST/DAST ã¯å‹•ãã¾ã™ï¼ˆSCA/SBOM ã¯èª¿æ•´å¿…è¦ï¼‰ã€‚

### 2.2 æ–¹æ³•Bï¼šã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ãƒ™ãƒ¼ã‚¹ã«æ–°è¦ä½œæˆ
- ã“ã® repo ã‚’ãã®ã¾ã¾åˆ©ç”¨ã—ã€`app-*` ã‚’é–‹ç™ºãƒ™ãƒ¼ã‚¹ã«ã—ã¾ã™ã€‚

---

## 3. ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œï¼ˆã™ãçµæœã‚’è¦‹ã‚‹ï¼‰
### å‰æ
- Java 21
- Maven 3.9+
- Dockerï¼ˆZAP ç”¨ï¼‰
- Python 3.12+
- ï¼ˆä»»æ„ï¼‰Semgrepï¼šç„¡ã‘ã‚Œã° Docker ã§å®Ÿè¡Œã—ã¾ã™ï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ Docker æ–¹å¼ï¼‰

### å®Ÿè¡Œ
Linux/macOS ã§å®Ÿè¡Œã™ã‚‹å ´åˆï¼š
```bash
chmod +x scripts/run_checks_local.sh
./scripts/run_checks_local.sh

Windows ã§å®Ÿè¡Œã™ã‚‹å ´åˆï¼š
scripts/run_checks_local.bat
```

### å‡ºåŠ›ï¼ˆçµæœï¼‰
å®Ÿè¡Œçµæœã¯ `reports/YYYY-MM-DD_HHMMSS/` ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã•ã‚Œã¾ã™ï¼š

| ãƒ•ã‚¡ã‚¤ãƒ« | èª¬æ˜ |
|---------|------|
| `semgrep.sarif` | SASTï¼ˆSemgrep æ¨™æº–ãƒ«ãƒ¼ãƒ«ï¼‰|
| `semgrep-custom.sarif` | SASTï¼ˆè‡ªç¤¾ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ï¼‰|
| `dependency-check-report.json` | SCAï¼ˆä¾å­˜é–¢ä¿‚è„†å¼±æ€§ï¼‰|
| `bom.json` | SBOMï¼ˆCycloneDX å½¢å¼ï¼‰|
| `zap-report.html` / `.json` | DASTï¼ˆZAP å‹•çš„ã‚¹ã‚­ãƒ£ãƒ³ï¼‰|
| `trivy-fs.json` | Container/FS ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆTrivyï¼‰|
| `trivy-image.json` | Docker ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆTrivyï¼‰|
| `gitleaks.sarif` | Secret Detectionï¼ˆGitleaksï¼‰|
| `security-remediation.md` | å¯¾ç­–æ¡ˆï¼ˆMarkdownï¼‰|
| **`security-report.html`** | **çµ±åˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆæ¨å¥¨ï¼‰** |

> ğŸ’¡ **çµ±åˆHTMLãƒ¬ãƒãƒ¼ãƒˆ** ã¯å…¨ãƒ„ãƒ¼ãƒ«ã®çµæœã‚’1ã¤ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«é›†ç´„ã—ã€
> é‡å¤§åº¦åˆ¥ã‚µãƒãƒªãƒ¼ãƒ»OWASPåˆ†é¡ãƒ»å‰å›æ¯”è¼ƒãŒä¸€ç›®ã§ç¢ºèªã§ãã¾ã™ã€‚

---

## 4. GitLab CI å®Ÿè¡Œï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ push ã™ã‚Œã°è‡ªå‹•ï¼‰
- `.gitlab-ci.yml` ãŒåŒæ¢±æ¸ˆã¿ã§ã™ã€‚Push ã™ã‚‹ã¨ï¼š
  - build/test
  - SASTï¼ˆSemgrepï¼‰
  - SCAï¼ˆDependency-Checkï¼‰
  - SBOMï¼ˆCycloneDXï¼‰
  - DASTï¼ˆZAPï¼‰
  - å¯¾ç­–æ¡ˆç”Ÿæˆï¼ˆsecurity-remediation.mdï¼‰
ãŒ artifact ã¨ã—ã¦ä¿å­˜ã•ã‚Œã¾ã™ã€‚

---

## 5. Autofixï¼ˆè‡ªå‹•ä¿®æ­£ï¼‰é‹ç”¨ãƒ«ãƒ¼ãƒ«ï¼ˆé‡è¦ï¼‰
- **main ãƒ–ãƒ©ãƒ³ãƒã§ã¯è‡ªå‹•ä¿®æ­£ã—ãªã„**ï¼ˆå·®åˆ†ãŒæ··ã–ã‚‹ã¨äº‹æ•…ã«ãªã‚‹ãŸã‚ï¼‰
- ä¿®æ­£å°‚ç”¨ãƒ–ãƒ©ãƒ³ãƒï¼ˆä¾‹ï¼š`fix/security-*`ï¼‰ã§ã®ã¿ï¼š
  - `semgrep --autofix` ã‚’è¨±å¯
- è‡ªå‹•ä¿®æ­£ã¯ã€Œä½ãƒªã‚¹ã‚¯æ©Ÿæ¢°å¤‰æ›ã€ã®ãƒ«ãƒ¼ãƒ«ã®ã¿ï¼ˆä¾‹ï¼šString ã® `==` â†’ `equals()`ï¼‰

---

## 6. ç§»è¡Œè¨­è¨ˆï¼ˆå»¶æœŸé˜²æ­¢ï¼‰é‹ç”¨ï¼ˆå¿…é ˆï¼‰
- `docs/migration-design.md` ã‚’ Phase Aï¼ˆåˆ¤æ–­ï¼‰ã®æˆæœã¨ã—ã¦å¿…ãšåŸ‹ã‚ã‚‹ï¼š
  - ä¸€å›åˆ‡ã‚Šã®å¢ƒç•Œï¼ˆOne-Cut Boundaryï¼‰
  - ãƒ‡ãƒ¼ã‚¿ä¸»æ¨©ï¼ˆSSOTï¼‰
  - é€£æºæ–¹å¼ã®å„ªå…ˆé †ä½ï¼ˆFile/MQ/APIï¼‰
  - Go/No-Goï¼ˆåˆæ³•ã«æ­¢ã¾ã‚Œã‚‹ã‚²ãƒ¼ãƒˆï¼‰
ã“ã‚ŒãŒç„¡ã„ã¨ã€å¾Œå·¥ç¨‹ã§å¿…ãšæ‰‹æˆ»ã‚Šã—ã¾ã™ã€‚

---

## 7. ã‚ˆãã‚ã‚‹èª¿æ•´ãƒã‚¤ãƒ³ãƒˆ
- ã‚¢ãƒ—ãƒªã®èµ·å‹•ãƒãƒ¼ãƒˆï¼š`dast_zap` ã¯ `localhost:8080` ã‚’å‰æ
- èªè¨¼ãŒå¿…è¦ãª APIï¼šZAP ã® context ã«èªè¨¼è¨­å®šï¼ˆå¿…è¦ã«å¿œã˜ã¦è¿½åŠ ï¼‰
- å¤§è¦æ¨¡ã‚¢ãƒ—ãƒªï¼šZAP ã®æ¢ç´¢ç¯„å›²ã¨æ™‚é–“ã‚’èª¿æ•´

---
## 8. è¿½åŠ ã‚¹ã‚­ãƒ£ãƒ³ï¼ˆContainer / Secretï¼‰
ã“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ä»¥ä¸‹ã‚‚åŒæ¢±ã—ã¦ã„ã¾ã™ï¼š
- Container Scanningï¼šTrivyï¼ˆDockerã‚¤ãƒ¡ãƒ¼ã‚¸/FSï¼‰
- Secret Detectionï¼šGitleaksï¼ˆSARIFï¼‰

**æ³¨æ„ï¼ˆæ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸é©ç”¨ã™ã‚‹éš›ï¼‰**
- Container Scanningï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã‚¹ã‚­ãƒ£ãƒ³ï¼‰ã¯ `Dockerfile` ãŒã‚ã‚‹å ´åˆã«æœ‰åŠ¹ã§ã™ã€‚ç„¡ã„å ´åˆã¯ FS ã‚¹ã‚­ãƒ£ãƒ³ã®ã¿å®Ÿè¡Œã—ã¾ã™ã€‚
- GitLab Runner ãŒ Docker-in-Docker ã‚’å®Ÿè¡Œã§ãã‚‹æ§‹æˆã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆContainer Scanning ã‚¸ãƒ§ãƒ–ã®ã¿ï¼‰ã€‚

å‡ºåŠ›ï¼š
- `trivy-fs.json`ï¼ˆä¾å­˜/OSå±¤ã®æ¤œå‡ºå«ã‚€ï¼‰
- `trivy-image.json`ï¼ˆDockerfile ãŒã‚ã‚Šã€ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã§ãã‚‹å ´åˆï¼‰
- `gitleaks.sarif`

---

## 9. çµ±åˆHTMLãƒ¬ãƒãƒ¼ãƒˆï¼ˆæ¨å¥¨ï¼‰

### æ¦‚è¦
è¤‡æ•°ãƒ„ãƒ¼ãƒ«ã®çµæœã‚’1ã¤ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«çµ±åˆã—ã€ä»¥ä¸‹ã‚’æä¾›ã—ã¾ã™ï¼š
- **ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼**ï¼šé‡å¤§åº¦åˆ¥ãƒ»ãƒ„ãƒ¼ãƒ«åˆ¥ã®æ¤œå‡ºæ•°
- **OWASP Top 10:2025 åˆ†é¡**ï¼šã‚«ãƒ†ã‚´ãƒªåˆ¥ã®è„†å¼±æ€§åˆ†å¸ƒ
- **å·®åˆ†æ¯”è¼ƒ**ï¼šå‰å›å®Ÿè¡Œã¨ã®æ¯”è¼ƒï¼ˆæ–°è¦/ä¿®æ­£æ¸ˆã¿/ç¶™ç¶šä¸­ï¼‰
- **è©³ç´°ä¸€è¦§**ï¼šãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»ã‚½ãƒ¼ãƒˆå¯èƒ½ãªãƒ†ãƒ¼ãƒ–ãƒ«

### å®Ÿè¡Œå±¥æ­´ç®¡ç†
```
reports/
â”œâ”€â”€ 2025-01-15_143022/    # å®Ÿè¡Œæ—¥æ™‚ãƒ•ã‚©ãƒ«ãƒ€
â”‚   â”œâ”€â”€ security-report.html
â”‚   â”œâ”€â”€ security-remediation.md
â”‚   â”œâ”€â”€ semgrep.sarif
â”‚   â””â”€â”€ ...
â”œâ”€â”€ 2025-01-14_091530/    # å‰å›å®Ÿè¡Œ
â””â”€â”€ latest -> 2025-01-15_143022/  # æœ€æ–°ã¸ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
```

### å˜ç‹¬ã§HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ
```bash
python tools/remediate/generate_html_report.py --input-dir reports/latest --output reports/latest/security-report.html
```

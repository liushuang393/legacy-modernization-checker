# 移行設計書（COBOL → Java）テンプレート
版数：v0.1  
作成日：  
作成者：  
対象システム：  
対象範囲：  

---

## 1. 目的・前提
### 1.1 目的
- 旧システム（COBOL）を Java（Spring Boot + Spring Batch）へ移行し、段階的にモダナイズする。
- 実装前に「不可逆な判断（境界/データ主権/連携/ゲート）」を確定し、延期・手戻りを最小化する。

### 1.2 成立条件（未達の場合は No-Go/縮小）
- 業務側前提（締め時間、ピーク、SLA）
- 外部連携の試験環境（有/無）
- データ品質（欠損/重複/コード体系の揺れ）
- 性能測定に必要な代表データ/測定手段の提供

---

## 2. ターゲットアーキテクチャ（Web/Batch/共通）
- Web：Spring Boot（API/画面）
- Batch：Spring Batch（Job/Step）
- 共通：Security Baseline（認証/認可、監査ログ、例外/エラー方針、入力検証）
- Infra：DB/MQ/ファイル連携 Adapter

---

## 3. 一回切りの境界（One-Cut Boundary）
### 3.1 業務境界（Domain Boundary）
- 切断対象の業務ドメイン：
- 切断しない業務ドメイン（理由）：

### 3.2 データ主権（SSOT：三択で固定）
- [ ] A：Legacy 主権（Java は参照/派生）
- [ ] B：Java 主権（Legacy は参照/段階退役）
- [ ] C：同期点明示（例：日次/時次バッチ）。双方向常時同期は禁止。

> 決定理由：  
> 主権対象データ一覧（テーブル/ファイル）：  
> 並行期間の終了条件（いつ双系を終えるか）：  

---

## 4. 連携方式（優先順位を固定）
優先順位（原則）：  
1) File/Batch（安定優先）  
2) MQ（次点）  
3) API（最後。必要性・認証・監査を明文化）  

連携一覧（COBOL ↔ Java）：
| ID | 連携名 | 方式 | データ | 頻度 | 認証/暗号 | 冪等性 | 障害時挙動 |
|---|---|---|---|---|---|---|---|

---

## 5. データ移行
- 初期移行（ロード）方式：
- 増分（差分）方式：
- 並行稼働の照合方法（頻度/差分許容）：
- 監査ログの扱い：

---

## 6. バッチ移行（Spring Batch）
### 6.1 Job 分解（COBOL/JCL → Job/Step）
| 旧Job | 新Job | Step | 入力 | 出力 | 再実行 | 冪等性キー | SLA |
|---|---|---|---|---|---|---|---|

### 6.2 冪等性・再実行（必須）
- 冪等性キー：
- リトライ/リスタート方針：
- ロールバック単位（チャンク/Tx境界）：

### 6.3 性能モデル（必須）
- 最大データ量：
- 同時実行数：
- 目標処理時間（締め時間制約）：

---

## 7. Go/No-Go ゲート（合法に止まれる条件）
### 7.1 技術ゲート
- 性能：P95 / バッチ所要時間
- 重大バグ：P0/P1
- セキュリティ：High/Critical の扱い（CI Gate）

### 7.2 運用ゲート
- 監視/アラート：必須メトリクス/ログ
- ロールバック：手順・演習記録

---

## 8. 検証計画（証跡を残す）
- SAST（Semgrep SARIF）
- SCA（Dependency-Check）
- SBOM（CycloneDX）
- DAST（ZAP）
- Container Scanning（Trivy）
- Secret Detection（Gitleaks）

---

## 9. リスク登録簿（Risk Register）
| ID | リスク | 影響 | 確率 | 検知方法 | 対策 | 受容判断 |
|---|---|---|---|---|---|---|
